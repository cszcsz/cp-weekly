<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>cp</title>

  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <!-- Place favicon.ico in the root directory -->

  <!-- build:css styles/vendor.css -->
  <!-- bower:css -->
  <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.css"/>
  <!-- Link Swiper's CSS -->
  <link rel="stylesheet" href="styles/swiper.min.css">
  <link rel="stylesheet" href="styles/swiperdemo.css">
  <link rel="stylesheet" href="styles/next.css">

  <!-- Demo styles -->
  <style>

  </style>
</head>
<body>
<!-- Swiper -->
<div class="swiper-container">
  <div class="swiper-wrapper">
    <div class="swiper-slide">
      <div class="container">
        <div class="row">
          <img class="q" src="images/21.png" alt="">
        </div>

        <div class="bt">
          <button class="kaishi1" id="btn1">
            <p>男</p>
          </button>
          <button class="kaishi2" id="btn2">
            <p>女</p>
          </button>
        </div>


      </div>
    </div>
    <div class="swiper-slide">
      <div class="container">
        <div class="row">
          <img class="q" src="images/23.png" alt="">
        </div>
        <div class="bt">
          <button class="kaishi1" id="btn3">
            <p>男</p>
          </button>
          <button class="kaishi2" id="btn4">
            <p>女</p>
          </button>

        </div>

      </div>


    </div>
    <div class="swiper-slide">
      <div id="d3" class="container">
        <div id="xiangxi">
          <img id="info" src="images/252.png" alt="">
        </div>
        <div id="jishiben">
          <form id="biaodan">
            <div class="form-group">
              <label>你的专业班级</label>
              <input id="majorclass" type="text" class="form-control">
            </div>
            <div class="form-group">
              <label>你的家乡</label>
              <input id="jiaxiang" type="text" class="form-control">
            </div>
            <div class="form-group">
              <label>你的兴趣爱好</label>
              <input id="aihao" type="text" class="form-control">
            </div>
            <div class="form-group">
              <label>你的QQ</label>
              <input id="qq" type="text" class="form-control">
            </div>
          </form>
        </div>
      </div>


    </div>

    <div class="swiper-slide">
      <div class="container">
        <div class="row" id="shangchuan">
          <input type="file" id="upload" name="image"/>
          <img id="head" class="q img-circle" src="images/24.png" alt="">
        </div>
        <div class="row">
          <div class="col-center-block">
            <h4 id="name">你的昵称</h4>
            <input id="inputname" class="form-control" type="text">

          </div>

        </div>

        <button class="btn btn-primary" id="wancheng"><p id="wa">完成</p></button>
      </div>

    </div>
  </div>
  <!-- Add Pagination -->
  <div class="swiper-pagination"></div>
  <div class="swiper-button-next">
  </div>
  <div class="swiper-button-prev">
  </div>
</div>

<!--<script src="https://unpkg.com/axios/dist/axios.min.js"></script>-->
<!-- Swiper JS -->
<script src="scripts/jquery-1.10.1.min.js"></script>
<script src="scripts/swiper-3.4.2.jquery.min.js"></script>
<script src="layer/layer.js"></script>
<!--<script src="scripts/swiper.min.js"></script>-->

<!-- Initialize Swiper -->
<script>
  var swiper = new Swiper('.swiper-container', {
    pagination: {
      el: '.swiper-pagination',
      dynamicBullets: true,
    },
    prevButton: '.swiper-button-prev',
    nextButton: '.swiper-button-next',
  });

  $("#btn3").click(function () {
    $("#btn4").removeClass("act2").addClass("kaishi2");
    $("#btn3").removeClass("kaishi1").addClass("act1");
  })

  $("#btn4").click(function () {
    $("#btn3").removeClass("act1").addClass("kaishi1");
    $("#btn4").removeClass("kaishi2").addClass("act2");
  })

  $("#btn1").click(function () {
    $("#btn2").removeClass("act2").addClass("kaishi2");
    $("#btn1").removeClass("kaishi1").addClass("act1");
  })

  $("#btn2").click(function () {
    $("#btn1").removeClass("act1").addClass("kaishi1");
    $("#btn2").removeClass("kaishi2").addClass("act2");
//      $(".swiper-button-next>button").attr("disabled","false");
  })


  $("#upload").change(function(){
    // getObjectURL是自定义的函数，见下面
    // this.files[0]代表的是选择的文件资源的第一个，因为上面写了 multiple="multiple" 就表示上传文件可能不止一个
    // ，但是这里只读取第一个
    var objUrl = getObjectURL(this.files[0]) ;
    // 这句代码没什么作用，删掉也可以
    // console.log("objUrl = "+objUrl) ;
    if (objUrl) {
      // 在这里修改图片的地址属性
      $("#head").attr("src", objUrl) ;
    }
  });

  //建立一个可存取到该file的url
  function getObjectURL(file) {
    var url = null ;
    // 下面函数执行的效果是一样的，只是需要针对不同的浏览器执行不同的 js 函数而已
    if (window.createObjectURL!=undefined) { // basic
      url = window.createObjectURL(file) ;
    }  else if (window.URL!=undefined) { // webkit or chrome
      url = window.URL.createObjectURL(file) ;
    }
    return url;
  }


//  信息提交及验证
  $("#wancheng").click(function () {
    var text = $("#inputname").val();
    if ((($("#btn1").attr("class") == "kaishi1") && (($("#btn2").attr("class") == "kaishi2"))) ||
      (($("#btn3").attr("class") == "kaishi1") && (($("#btn4").attr("class") == "kaishi2"))) ||
      ($(".form-group>input").val() == "") || text == "") {
        layer.msg('请完善信息');
    }
    else {
      layer.load(2);
      sendinfo();
    }
  })


  //用户注册,使用formdata发送数据
  function sendinfo() {
    var name = $("#inputname").val();
    var majorclass = $("#majorclass").val();
    var home = $("#jiaxiang").val();
    var hobby = $("#aihao").val();
    var qq = $("#qq").val();
    var mail = "123456789@qq.com";
    var sex = 1;
    var cpsex = 0;
    $("#btn1").click(function () {
      sex = 1;
    });
    $("#btn2").click(function () {
      sex = 0;
    });
    $("#btn3").click(function () {
      cpsex = 1;
    });
    $("#btn4").click(function () {
      cpsex = 0;
    });

    var formData = new FormData();
    formData.append("Authorization",sessionStorage.vq);
    formData.append("name",name);
    formData.append("majorWithClass",majorclass);
    formData.append("mail",mail);
    formData.append("qq",qq);
    formData.append("sex",sex);
    formData.append("isLoveMan",cpsex);
    formData.append("hobby",hobby);
    formData.append("headerImage",document.getElementById('upload').files[0]);
    formData.append("yibanId",sessionStorage.ybid);

    var i = formData.entries();
    console.log(i.next());

    fetch("http://localhost:8084/leinuo/weekcp/user/register", {
      method: "POST",
      body: formData
    }).then(response => response.json())
      .then(data => {
        console.log(data);
        if (data.success == 1) {
          console.log("注册成功");
          setTimeout(function () {
            window.location = 'success.html';
          }, 0)
        }
      })
      .catch(e => console.log("Oops, error", e))

    //之前写的fetch
    //    var url = "http://localhost:8084/leinuo/weekcp/user/register?" + "Authorization=" + sessionStorage.vq + "&name=" + name + "&majorWithClass=" + majorclass + "&mail=" + mail + "&qq=" + qq + "&sex=" + sex + "&isLoveMan=" + cpsex + "&hobby=" + hobby + "&headerImage="+ imgurl + "&yibanId=" + sessionStorage.ybid;
    //    console.log(url);
    //    fetch(url).then(response => response.json())
    //      .then(data => {
    //        console.log(data);
    //        if (data.success == 1) {
    //          setTimeout(function () {
    //            window.location = 'success.html';
    //          }, 0)
    //        }
    //      })
    //      .catch(e => console.log("Oops, error", e))
  }


</script>
</body>
</html>
