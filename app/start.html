<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>cp</title>

  <link rel="apple-touch-icon" href="apple-touch-icon.png">

  <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.css" />

  <link rel="stylesheet" href="styles/main.css">


</head>
<body>


<div class="container-fluid">
  <div id="aixin">
    <img id="xin1" class="xin" src="images/left.png"  width="220" height="330">
    <img id="xin2" class="xin" src="images/right.png"  width="190" height="392">
  </div>

  <div id="bt">
    <a href="#" class="btn" ><img  id="photo"  src="images/button.png"></a>
  </div>

</div>

<script src="/bower_components/jquery/dist/jquery.js"></script>
<script src="scripts/jquery.easing.min.js"></script>

<script>
  function getQueryString(name) {
    var reg = new RegExp('(^|&)' + name + '=([^&]*)(&|$)', 'i');
    var r = window.location.search.substr(1).match(reg);
    if (r !== null) {
      return unescape(r[2]);
    }
    return null;
  }
  var vq = getQueryString("verify_request");
  console.log(vq);
  sessionStorage.vq = vq;

  main();
 function main() {
    //  获取用户的易班id，包括其他信息
    var url = "http://localhost:8084/leinuo/weekcp/user/getYiMeByToken?" + "Authorization=" + sessionStorage.vq;
    fetch(url).then(response => response.json())
      .then(data => {
        console.log(data);
        if (data.success == 1) {
          console.log("获取用户信息成功！");
          sessionStorage.ybid = data.data.yb_userid;     //储存用户的ybid
        }
      })
      .catch(e => console.log("Oops, error", e))

  }

  if (sessionStorage.vq == 'null')
  {
    window.location.href = "index.html";
  }


  //待办：需要处理用户已经注册过，再次登录时的页面跳转情况




  //如果需要用学校易班内部的token则请求易班auth接口，获取token
//  else {
//    var vq =sessionStorage.vq;
//    $.post('http://yb.upc.edu.cn:8084/auth',{
//      appName:'应用反馈',
//      vq:vq,
//      device:'default'
//    },function (data) {
//      console.log(data);
//      sessionStorage.token=data.token;
//    });
//  }

  $('a').click(function () {
    move();
  })
  function move(){
    $('#xin2').animate({top:'46px'},1500,'easeOutCirc',function(){

    });
    $('#xin1').animate({top:'33px'},1500,'easeOutCirc',function(){
      $('img').fadeOut('slow');
      setTimeout('window.location=\'next.html\'',1000)
    });
  }


</script>

</body>
</html>
